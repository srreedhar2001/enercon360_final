<!-- Navigation Component -->
<nav class="glass-effect fixed w-full top-0 z-50" id="mainNavigation">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <img src="/assets/logo.jpeg" alt="360" class="h-[50px] w-[100px] object-contain rounded-lg shadow-sm" loading="lazy" />
                </div>
                <span class="ml-1 text-gray-900 font-bold text-lg">360</span>
            </div>
            <!-- Mobile menu button -->
            <div class="md:hidden">
                <button id="mobileMenuBtn" type="button" onclick="toggleMobileMenu()" class="inline-flex items-center justify-center p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-controls="mobileMenu" aria-expanded="false">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5" />
                    </svg>
                </button>
            </div>
            <div class="hidden md:block">
                <div class="ml-10 flex items-baseline space-x-4">
                    <!-- <a href="/home.html" class="nav-link" data-page="home">Home</a>
                    <a href="#" class="nav-link" data-page="features">Features</a> -->
                    <a href="/product.html" class="nav-link" data-page="products">Products</a>
                    <a href="/counter.html" class="nav-link" data-page="counters">Counters</a>
                    <!-- Transactions Menu -->
                    <div class="relative group">
                        <button class="nav-link inline-flex items-center" data-page="transactions" aria-haspopup="true" aria-expanded="false">
                            Transactions
                            <svg class="ml-1 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-0 z-50 w-56 max-h-96 overflow-y-auto rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden group-hover:block">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                                <a href="/order.html" class="nav-link block w-full text-left" data-page="orders" role="menuitem" tabindex="-1">Orders</a>
                                <a href="/collections.html" class="nav-link block w-full text-left" data-page="collections" role="menuitem" tabindex="-1">Collections</a>
                                <a href="/payments.html" class="nav-link block w-full text-left" data-page="payments" role="menuitem" tabindex="-1">Payments</a>
                            </div>
                        </div>
                    </div>
                    <a href="/myOrders.html" class="nav-link" data-page="my-orders">My Orders</a>
                    <a href="/countersdue.html" class="nav-link" data-page="counters-due">Counters Due</a>
                    <!-- Reports Menu -->
                    <div class="relative group">
                        <button class="nav-link inline-flex items-center" data-page="reports" aria-haspopup="true" aria-expanded="false">
                            Reports
                            <svg class="ml-1 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-0 z-50 w-64 max-h-96 overflow-y-auto rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden group-hover:block">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                <a href="/dashboard.html" class="nav-link block w-full text-left" data-page="dashboard" role="menuitem" tabindex="-1">Dashboard</a>
                                <a href="/RepSalesReport.html" class="nav-link block w-full text-left" data-page="rep-sales-report" role="menuitem" tabindex="-1">Rep Sales Report</a>
                                <a href="/SalesVsExpReport.html" class="nav-link block w-full text-left" data-page="sales-vs-exp-report" role="menuitem" tabindex="-1">Sales vs Expenses Report</a>
                                <a href="/newCounters.html" class="nav-link block w-full text-left" data-page="new-counters-report" role="menuitem" tabindex="-1">New Counters Report</a>
                                <a href="/WorkLog.html" class="nav-link block w-full text-left" data-page="work-log-report" role="menuitem" tabindex="-1">Work Log</a>
                                <a href="/createdoctorslist.html" class="nav-link block w-full text-left" data-page="doctor-calls" role="menuitem" tabindex="-1">Doctor Management</a>
                                <a href="/logs.html" class="nav-link block w-full text-left" data-page="user-logs" role="menuitem" tabindex="-1">User Logs</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Others Menu -->
                    <div class="relative group">
                        <button class="nav-link inline-flex items-center" data-page="others" aria-haspopup="true" aria-expanded="false">
                            Others
                            <svg class="ml-1 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-0 z-50 w-56 max-h-96 overflow-y-auto rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden group-hover:block">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                                <a href="/user.html" class="nav-link block w-full text-left" data-page="users" role="menuitem" tabindex="-1">Users</a>
                                <a href="/page-access.html" class="nav-link block w-full text-left" data-page="page-access" role="menuitem" tabindex="-1">Page Access</a>
                            </div>
                        </div>
                    </div>
                    <!-- <a href="#" class="nav-link" data-page="about">About</a>
                    <a href="#" class="nav-link" data-page="contact">Contact</a> -->
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span id="userInfo" class="text-gray-700 font-medium hidden"></span>
                <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hidden">
                    Sign Out
                </button>
                <a href="/login.html" id="loginBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300">
                    Sign In
                </a>
            </div>
        </div>
        <!-- Mobile menu panel -->
        <div id="mobileMenu" class="md:hidden hidden border-t border-gray-200 bg-white">
            <div class="px-4 py-3 space-y-1">
                <a href="/product.html" class="nav-link block" data-page="products">Products</a>
                <a href="/counter.html" class="nav-link block" data-page="counters">Counters</a>
                <!-- Transactions collapsible -->
                <button type="button" class="w-full text-left nav-link flex items-center justify-between mobile-collapse" data-toggle-target="#mm-transactions" onclick="toggleCollapse('#mm-transactions')">
                    <span>Transactions</span>
                    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
                </button>
                <div id="mm-transactions" class="ml-4 hidden">
                    <a href="/order.html" class="nav-link block" data-page="orders">Orders</a>
                    <a href="/collections.html" class="nav-link block" data-page="collections">Collections</a>
                    <a href="/payments.html" class="nav-link block" data-page="payments">Payments</a>
                </div>
                <a href="/myOrders.html" class="nav-link block" data-page="my-orders">My Orders</a>
                <a href="/countersdue.html" class="nav-link block" data-page="counters-due">Counters Due</a>
                <!-- Reports collapsible -->
                <button type="button" class="w-full text-left nav-link flex items-center justify-between mobile-collapse" data-toggle-target="#mm-reports" onclick="toggleCollapse('#mm-reports')">
                    <span>Reports</span>
                    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
                </button>
                <div id="mm-reports" class="ml-4 hidden">
                    <a href="/dashboard.html" class="nav-link block" data-page="dashboard">Dashboard</a>
                    <a href="/RepSalesReport.html" class="nav-link block" data-page="rep-sales-report">Rep Sales Report</a>
                    <a href="/SalesVsExpReport.html" class="nav-link block" data-page="sales-vs-exp-report">Sales vs Expenses Report</a>
                    <a href="/newCounters.html" class="nav-link block" data-page="new-counters-report">New Counters Report</a>
                    <a href="/WorkLog.html" class="nav-link block" data-page="work-log-report">Work Log</a>
                    <a href="/createdoctorslist.html" class="nav-link block" data-page="doctor-calls">Doctor Management</a>
                    <a href="/logs.html" class="nav-link block" data-page="user-logs">User Logs</a>
                </div>
                <!-- Others collapsible -->
                <button type="button" class="w-full text-left nav-link flex items-center justify-between mobile-collapse" data-toggle-target="#mm-others" onclick="toggleCollapse('#mm-others')">
                    <span>Others</span>
                    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
                </button>
                <div id="mm-others" class="ml-4 hidden">
                    <a href="/user.html" class="nav-link block" data-page="users">Users</a>
                    <a href="/page-access.html" class="nav-link block" data-page="page-access">Page Access</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<style>
    .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .nav-link {
        color: rgb(75 85 99);
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: color 0.3s ease;
        text-decoration: none;
    }
    
    .nav-link:hover {
        color: rgb(79 70 229);
    }
    
    .nav-link.active {
        color: rgb(17 24 39);
        font-weight: 600;
    }
    /* Dropdown hover/focus for Reports */
    .group:hover .group-hover\:block, .group:focus-within .group-hover\:block { display: block; }
</style>

<script>
    // Navigation functionality
    function initializeNavigation() {
        // Check if user is logged in
        const token = localStorage.getItem('authToken');
        const userData = localStorage.getItem('userData');
        
        if (token) {
            // Always show logout when authenticated
            document.getElementById('logoutBtn').classList.remove('hidden');
            document.getElementById('loginBtn').classList.add('hidden');
            // Show user info only if present
            if (userData) {
                const user = JSON.parse(userData);
                document.getElementById('userInfo').textContent = `Welcome, ${user.name || user.mobile || user.emailID || ''}`;
                document.getElementById('userInfo').classList.remove('hidden');
            }
        }
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('token');
            localStorage.removeItem('userData');
            if (window.__accessCache) window.__accessCache = { loaded: false, designationId: null, modules: [], permissions: {} };
            window.location.href = '/login.html';
        });
        
        // Set active navigation item
        const currentPage = getCurrentPage();
        setActiveNavItem(currentPage);
        
        // Add navbar background on scroll
        window.addEventListener('scroll', function() {
            const nav = document.querySelector('#mainNavigation');
            if (window.scrollY > 0) {
                nav.classList.add('bg-white', 'shadow-lg');
                nav.classList.remove('glass-effect');
            } else {
                nav.classList.remove('bg-white', 'shadow-lg');
                nav.classList.add('glass-effect');
            }
        });
    }
    
    function getCurrentPage() {
        const path = window.location.pathname;
        const keys = [];
        const pushKey = (key) => {
            if (key && !keys.includes(key)) keys.push(key);
        };

        if (path.includes('home.html') || path === '/') pushKey('home');
        if (path.includes('dashboard.html')) pushKey('dashboard');
        if (path.includes('product.html')) pushKey('products');
        if (path.includes('counter.html')) pushKey('counters');
        if (path.includes('order.html')) { pushKey('orders'); pushKey('transactions'); }
        if (path.includes('collections.html')) { pushKey('collections'); pushKey('transactions'); }
        if (path.includes('payments.html')) { pushKey('payments'); pushKey('transactions'); }
        if (path.includes('myOrders.html')) pushKey('my-orders');
        if (path.includes('countersdue.html')) pushKey('counters-due');
        if (path.includes('RepSalesReport.html')) { pushKey('rep-sales-report'); pushKey('reports'); }
        if (path.includes('SalesVsExpReport.html')) { pushKey('sales-vs-exp-report'); pushKey('reports'); }
        if (path.includes('newCounters.html')) { pushKey('new-counters-report'); pushKey('reports'); }
        if (path.includes('WorkLog.html')) { pushKey('work-log-report'); pushKey('reports'); }
        if (path.includes('createdoctorslist.html')) { pushKey('doctor-calls'); pushKey('reports'); }
        if (path.includes('page-access.html')) { pushKey('page-access'); pushKey('others'); }
        if (path.includes('user.html')) { pushKey('users'); pushKey('others'); }
        if (path.includes('features')) pushKey('features');
        if (path.includes('about')) pushKey('about');
        if (path.includes('contact')) pushKey('contact');

        return keys.length ? keys : ['home'];
    }
    
    function setActiveNavItem(page) {
        // Remove active class from all nav links
    document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
    const pages = Array.isArray(page) ? page : [page];
    pages.forEach(key => {
        document.querySelectorAll(`[data-page="${key}"]`).forEach(l => l.classList.add('active'));
    });
    }
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeNavigation);

    // Helpers: robust toggles for mobile
    function toggleMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        if (!menu) return;
        const nowHidden = menu.classList.toggle('hidden');
        const btn = document.getElementById('mobileMenuBtn');
        if (btn) btn.setAttribute('aria-expanded', (!nowHidden).toString());
    }

    function toggleCollapse(selector) {
        const tgt = document.querySelector(selector);
        if (tgt) tgt.classList.toggle('hidden');
    }

    // Mobile toggles
    document.addEventListener('click', function(e) {
        const btn = e.target.closest('#mobileMenuBtn');
        if (btn) {
            toggleMobileMenu();
        }
        const coll = e.target.closest('.mobile-collapse');
        if (coll) {
            const targetSel = coll.getAttribute('data-toggle-target');
            if (targetSel) {
                toggleCollapse(targetSel);
            }
        }
    });
</script>
